"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[88683],{15680:(e,a,t)=>{t.d(a,{xA:()=>g,yg:()=>f});var n=t(96540);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function i(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?i(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function o(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=n.createContext({}),c=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},g=function(e){var a=c(e.components);return n.createElement(s.Provider,{value:a},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},p=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,g=o(e,["components","mdxType","originalType","parentName"]),d=c(t),p=r,f=d["".concat(s,".").concat(p)]||d[p]||u[p]||i;return t?n.createElement(f,l(l({ref:a},g),{},{components:t})):n.createElement(f,l({ref:a},g))}));function f(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var i=t.length,l=new Array(i);l[0]=p;var o={};for(var s in a)hasOwnProperty.call(a,s)&&(o[s]=a[s]);o.originalType=e,o[d]="string"==typeof e?e:r,l[1]=o;for(var c=2;c<i;c++)l[c]=t[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},11689:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var n=t(58168),r=(t(96540),t(15680));const i={title:"Airflow Scheduling Engine Example",sidebar_position:3},l=void 0,o={unversionedId:"quick_start/offline_data_sync/airflow_example",id:"quick_start/offline_data_sync/airflow_example",title:"Airflow Scheduling Engine Example",description:"In the following sections, we will walk through a complete example to demonstrate how to integrate the third-party scheduling engine Airflow into Apache InLong to create an offline data synchronization from Pulsar to MySQL.",source:"@site/docs/quick_start/offline_data_sync/airflow_example.md",sourceDirName:"quick_start/offline_data_sync",slug:"/quick_start/offline_data_sync/airflow_example",permalink:"/docs/next/quick_start/offline_data_sync/airflow_example",draft:!1,editUrl:"https://github.com/apache/inlong-website/edit/master/docs/quick_start/offline_data_sync/airflow_example.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Airflow Scheduling Engine Example",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"DolphinScheduler Scheduling Engine Example",permalink:"/docs/next/quick_start/offline_data_sync/dolphinscheduler_example"},next:{title:"HTTP Report Example",permalink:"/docs/next/quick_start/data_http_report/http_report"}},s={},c=[{value:"Deployment",id:"deployment",level:2},{value:"Install InLong",id:"install-inlong",level:3},{value:"Add Connectors",id:"add-connectors",level:3},{value:"Create Clusters And Data Target",id:"create-clusters-and-data-target",level:2},{value:"Create Cluster Tag",id:"create-cluster-tag",level:3},{value:"Register Pulsar Cluster",id:"register-pulsar-cluster",level:3},{value:"Create Data Target",id:"create-data-target",level:3},{value:"Airflow Initialize",id:"airflow-initialize",level:2},{value:"Get Original DAG",id:"get-original-dag",level:3},{value:"Create Original DAG",id:"create-original-dag",level:3},{value:"Airflow REST API",id:"airflow-rest-api",level:3},{value:"Configure InLong Manager",id:"configure-inlong-manager",level:3},{value:"Task Creation",id:"task-creation",level:2},{value:"Create Synchronization Task",id:"create-synchronization-task",level:3},{value:"Create Data Stream Group",id:"create-data-stream-group",level:3},{value:"Create Airflow Offline Task",id:"create-airflow-offline-task",level:3},{value:"Test Data",id:"test-data",level:2},{value:"Sending Data",id:"sending-data",level:3},{value:"Data Validation",id:"data-validation",level:3}],g={toc:c},d="wrapper";function u(e){let{components:a,...i}=e;return(0,r.yg)(d,(0,n.A)({},g,i,{components:a,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"In the following sections, we will walk through a complete example to demonstrate how to integrate the third-party scheduling engine Airflow into Apache InLong to create an offline data synchronization from Pulsar to MySQL."),(0,r.yg)("h2",{id:"deployment"},"Deployment"),(0,r.yg)("h3",{id:"install-inlong"},"Install InLong"),(0,r.yg)("p",null,"Before we begin, we need to install InLong. Here we provide two ways:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/docs/next/deployment/docker"},"Docker Deployment")," (Recommended)"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/docs/next/deployment/bare_metal"},"Bare Metal Deployment"))),(0,r.yg)("h3",{id:"add-connectors"},"Add Connectors"),(0,r.yg)("p",null,"Download the ",(0,r.yg)("a",{parentName:"p",href:"https://inlong.apache.org/downloads/"},"connectors")," corresponding to Flink version, and after decompression, place ",(0,r.yg)("inlineCode",{parentName:"p"},"sort-connector-jdbc-[version]-SNAPSHOT.jar")," in ",(0,r.yg)("inlineCode",{parentName:"p"},"/inlong-sort/connectors/")," directory."),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Currently, Apache InLong's offline data synchronization capability only supports Flink-1.18, so please download the 1.18 version of connectors.")),(0,r.yg)("h2",{id:"create-clusters-and-data-target"},"Create Clusters And Data Target"),(0,r.yg)("p",null,"When all containers are successfully started, you can access the InLong dashboard address ",(0,r.yg)("inlineCode",{parentName:"p"},"http://localhost"),", and use the following default account to log in."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"User: admin\nPassword: inlong\n")),(0,r.yg)("h3",{id:"create-cluster-tag"},"Create Cluster Tag"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Airflow Create Cluster Tag",src:t(69769).A,width:"1836",height:"699"})),(0,r.yg)("h3",{id:"register-pulsar-cluster"},"Register Pulsar Cluster"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Airflow Create Pulsar Cluster",src:t(28476).A,width:"1900",height:"849"})),(0,r.yg)("h3",{id:"create-data-target"},"Create Data Target"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Airflow Create Data Target",src:t(83790).A,width:"1890",height:"861"})),(0,r.yg)("p",null,"Execute the following SQL statement:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-mysql"},"CREATE TABLE sink_table (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n")),(0,r.yg)("h2",{id:"airflow-initialize"},"Airflow Initialize"),(0,r.yg)("h3",{id:"get-original-dag"},"Get Original DAG"),(0,r.yg)("p",null,"They can be obtained from ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/inlong"},"InLong"),"."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Airflow Get DAGs",src:t(96571).A,width:"934",height:"152"})),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Airflow does not provide an API for DAG creation, so two original DAGs are required. ",(0,r.yg)("inlineCode",{parentName:"p"},"dag_creator")," is used to create offline tasks, and ",(0,r.yg)("inlineCode",{parentName:"p"},"dag_cleaner")," is used to clean up offline tasks regularly.")),(0,r.yg)("h3",{id:"create-original-dag"},"Create Original DAG"),(0,r.yg)("p",null,"Place the DAG file in the Airflow default DAG directory and wait for a while. The Airflow scheduler will scan the directory and load the DAG:\n",(0,r.yg)("img",{alt:"Airflow Original DAG",src:t(90159).A,width:"1866",height:"261"})),(0,r.yg)("h3",{id:"airflow-rest-api"},"Airflow REST API"),(0,r.yg)("p",null,"By default, Airflow will reject all REST API requests. Please refer to the ",(0,r.yg)("a",{parentName:"p",href:"https://airflow.apache.org/docs/apache-airflow-providers-fab/stable/auth-manager/api-authentication.html"},"Airflow official documentation")," for configuration."),(0,r.yg)("h3",{id:"configure-inlong-manager"},"Configure InLong Manager"),(0,r.yg)("p",null,"Modify the configuration file according to the configuration file requirements and restart InLong Manager."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-properties"},"# InLong Manager URL accessible by the scheduler\nschedule.engine.inlong.manager.url=http://inlongManagerIp:inlongManagerPort\n# Management URL for Airflow\nschedule.engine.airflow.baseUrl=http://airflowIP:airflowPort\n# Username and password for Airflow REST API authentication\nschedule.engine.airflow.username=airflow\nschedule.engine.airflow.password=airflow\n# Connection used to save InLong Manager authentication information\nschedule.engine.airflow.connection.id=inlong_connection\n# The ids of the two original DAGs\nschedule.engine.airflow.cleaner.id=dag_cleaner\nschedule.engine.airflow.creator.id=dag_creator\n")),(0,r.yg)("h2",{id:"task-creation"},"Task Creation"),(0,r.yg)("h3",{id:"create-synchronization-task"},"Create Synchronization Task"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Airflow Create Synchronization Task",src:t(58096).A,width:"1897",height:"434"})),(0,r.yg)("h3",{id:"create-data-stream-group"},"Create Data Stream Group"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Airflow Data Stream Group",src:t(65148).A,width:"966",height:"714"})),(0,r.yg)("p",null,"Please refer to the following steps: ",(0,r.yg)("a",{parentName:"p",href:"/docs/next/quick_start/offline_data_sync/quartz_example"},"Quartz Scheduling Engine Example")),(0,r.yg)("h3",{id:"create-airflow-offline-task"},"Create Airflow Offline Task"),(0,r.yg)("p",null,"After approval and configuration, InLong Manager will trigger ",(0,r.yg)("inlineCode",{parentName:"p"},"dag_creator")," through the Airflow API to create the offline task DAG:"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Airflow Create Task DAG.png",src:t(20430).A,width:"1460",height:"319"})),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Airflow Create Task DAG Result",src:t(15472).A,width:"1862",height:"254"})),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Offline task DAG may not be scheduled immediately, because Airflow will scan DAG files regularly and add them to the schedule, so it may take some time.")),(0,r.yg)("p",null,"The offline task execution results are as follows:"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Airflow DAG Task Result",src:t(51759).A,width:"1369",height:"356"})),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Airflow will periodically call the interface provided by InLong Manager to submit Flink tasks according to the configuration in the ",(0,r.yg)("inlineCode",{parentName:"p"},"Create Data Stream Group")," section. This is why the authentication information of InLong Manager needs to be saved in the ",(0,r.yg)("inlineCode",{parentName:"p"},"Configure InLong Manager")," section.")),(0,r.yg)("h2",{id:"test-data"},"Test Data"),(0,r.yg)("h3",{id:"sending-data"},"Sending Data"),(0,r.yg)("p",null,"Use the Pulsar SDK to produce data into the Pulsar topic. An example is as follows:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'// Create pulsar client and producer\nPulsarClient pulsarClient = PulsarClient.builder().serviceUrl("pulsar://localhost:6650").build();\nProducer<byte[]> producer = pulsarClient.newProducer().topic("public/default/test").create();\n\n// Send a message\nfor (int i = 0; i < 10000; i++) {\n    // The field separator is |\n    String msgStr = i + "|msg-" + i;\n    MessageId msgId = producer.send(msgStr.getBytes(StandardCharsets.UTF_8));\n    System.out.println("Send msg : " + msgStr + " with msgId: " + msgId);\n}\n')),(0,r.yg)("h3",{id:"data-validation"},"Data Validation"),(0,r.yg)("p",null,"Then enter MySQL to check the data in the table:"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Airflow Synchronization Result",src:t(33503).A,width:"657",height:"362"})))}u.isMDXComponent=!0},51759:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_DAG_task_result-55fe34ee1a331ed1d7282c34a27da79c.png"},69769:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_create_cluster_tag-b129d586751d94a519eaf6ca1bf742f1.png"},83790:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_create_data_target-c88271bf62b207dc2180eb279b33ee3a.png"},28476:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_create_pulsar_cluster-964f0bbe98fff8cd844505c327f89422.png"},58096:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_create_synchronization_task-9efa5cb26be456ac3c47e2a052a12f65.png"},20430:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_create_task_DAG-32234a0875e2dc722b0b00bd01891647.png"},15472:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_create_task_DAG_result-44d64458db9ac85132fab3c3c38654e2.png"},65148:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_data_stream_group-891faab0773ee5c592a649672c9006a3.png"},96571:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_get_DAGs-39e2fe0d0feef1c6d024e0562ea6835c.jpg"},90159:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_original_DAG-f2cc9eb7da31aaf525d66f3144e44a09.png"},33503:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/airflow_synchronization_result-68ff88c1fddeeb434470ba5cd6173b45.png"}}]);