"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[59374],{15680:(e,r,o)=>{o.d(r,{xA:()=>p,yg:()=>f});var t=o(96540);function n(e,r,o){return r in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function i(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),o.push.apply(o,t)}return o}function a(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?i(Object(o),!0).forEach((function(r){n(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}function s(e,r){if(null==e)return{};var o,t,n=function(e,r){if(null==e)return{};var o,t,n={},i=Object.keys(e);for(t=0;t<i.length;t++)o=i[t],r.indexOf(o)>=0||(n[o]=e[o]);return n}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)o=i[t],r.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var l=t.createContext({}),c=function(e){var r=t.useContext(l),o=r;return e&&(o="function"==typeof e?e(r):a(a({},r),e)),o},p=function(e){var r=c(e.components);return t.createElement(l.Provider,{value:r},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},g=t.forwardRef((function(e,r){var o=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(o),g=n,f=d["".concat(l,".").concat(g)]||d[g]||u[g]||i;return o?t.createElement(f,a(a({ref:r},p),{},{components:o})):t.createElement(f,a({ref:r},p))}));function f(e,r){var o=arguments,n=r&&r.mdxType;if("string"==typeof e||n){var i=o.length,a=new Array(i);a[0]=g;var s={};for(var l in r)hasOwnProperty.call(r,l)&&(s[l]=r[l]);s.originalType=e,s[d]="string"==typeof e?e:n,a[1]=s;for(var c=2;c<i;c++)a[c]=o[c];return t.createElement.apply(null,a)}return t.createElement.apply(null,o)}g.displayName="MDXCreateElement"},64729:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var t=o(58168),n=(o(96540),o(15680));const i={title:"Configuration Instructions",sidebar_position:2},a="Parameter Configuration Description",s={unversionedId:"modules/transform/configuration",id:"modules/transform/configuration",title:"Configuration Instructions",description:"TransformConfig Configuration Description",source:"@site/docs/modules/transform/configuration.md",sourceDirName:"modules/transform",slug:"/modules/transform/configuration",permalink:"/docs/next/modules/transform/configuration",draft:!1,editUrl:"https://github.com/apache/inlong-website/edit/master/docs/modules/transform/configuration.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Configuration Instructions",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/docs/next/modules/transform/overview"},next:{title:"Overview",permalink:"/docs/next/data_node/extract_node/overview"}},l={},c=[{value:"TransformConfig Configuration Description",id:"transformconfig-configuration-description",level:2},{value:"SourceInfo Configuration Description",id:"sourceinfo-configuration-description",level:2},{value:"CSV",id:"csv",level:3},{value:"KV",id:"kv",level:3},{value:"ProtoBuffer",id:"protobuffer",level:3},{value:"Generate ProtoBuf Protocol Description",id:"generate-protobuf-protocol-description",level:4},{value:"Json",id:"json",level:3},{value:"SinkInfo Configuration Description",id:"sinkinfo-configuration-description",level:2},{value:"CSV",id:"csv-1",level:3},{value:"KV",id:"kv-1",level:3},{value:"CSV / KV Field Reference",id:"csv--kv-field-reference",level:2},{value:"ProtoBuf / Json Tree Structure Field Reference",id:"protobuf--json-tree-structure-field-reference",level:2},{value:"Operator Support",id:"operator-support",level:2},{value:"Function Description",id:"function-description",level:2},{value:"SQL Example",id:"sql-example",level:2}],p={toc:c},d="wrapper";function u(e){let{components:r,...i}=e;return(0,n.yg)(d,(0,t.A)({},p,i,{components:r,mdxType:"MDXLayout"}),(0,n.yg)("h1",{id:"parameter-configuration-description"},"Parameter Configuration Description"),(0,n.yg)("h2",{id:"transformconfig-configuration-description"},"TransformConfig Configuration Description"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'public class TransformConfig {\n\n    @JsonProperty("sourceInfo")\n    private SourceInfo sourceInfo;  // Definition of data source decoding\n    @JsonProperty("sinkInfo")\n    private SinkInfo sinkInfo;      // Definition of data result encoding\n    @JsonProperty("transformSql")\n    private String transformSql;    //Data transformation SQL\n}\n')),(0,n.yg)("h2",{id:"sourceinfo-configuration-description"},"SourceInfo Configuration Description"),(0,n.yg)("h3",{id:"csv"},"CSV"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'    public CsvSourceInfo(\n            @JsonProperty("charset") String charset,        // Character set\n            @JsonProperty("delimiter") String delimiter,    // Delimiter\n            @JsonProperty("escapeChar") String escapeChar,  // Escape character, if empty, no unescaping operation is performed during decoding\n            @JsonProperty("fields") List<FieldInfo> fields) // Field list, if empty, decode by default according to the delimiter, field names are assigned as $1, $2, $3... starting from 1;\n                                                            // If the number of defined fields is less than the number of decoded fields, the extra fields will be discarded\n      );\n')),(0,n.yg)("h3",{id:"kv"},"KV"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'    public KvSourceInfo(\n            @JsonProperty("charset") String charset,        // Character set\n            @JsonProperty("fields") List<FieldInfo> fields) // Field list, if empty, decode by default using the Key in KV as the field name\n                                                            // If the field name does not match the decoded field name, the field value will be empty, and extra field names will be discarded\n      );\n')),(0,n.yg)("h3",{id:"protobuffer"},"ProtoBuffer"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'    public PbSourceInfo(\n            @JsonProperty("charset") String charset,                    // Character set\n            @JsonProperty("protoDescription") String protoDescription,  // Base64 encoded ProtoBuf protocol description\n            @JsonProperty("rootMessageType") String rootMessageType,    // MessageType of the decoded source data, MessageType needs to be defined in the ProtoBuf protocol\n            @JsonProperty("rowsNodePath") String rowsNodePath)          // Array node path of the ProtoBuf protocol containing multiple data to be converted\n      );\n')),(0,n.yg)("h4",{id:"generate-protobuf-protocol-description"},"Generate ProtoBuf Protocol Description"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Install Protocol Buffers compiler")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},'PB_REL="https://github.com/protocolbuffers/protobuf/releases"\ncurl -LO $PB_REL/download/v3.15.8/protoc-3.15.8-linux-x86_64.zip\nunzip protoc-3.15.8-linux-x86_64.zip -d $HOME/.local\nexport PATH="$HOME/.local/bin:$PATH"\nprotoc --version\n#Displays libprotoc 3.15.8\n')),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Parse the protocol to generate a Base64 encoded description")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"# transform.proto is the proto protocol file, transform.description is the binary description file after parsing the protocol\nprotoc --descriptor_set_out=transform.description ./transform.proto --proto_path=.\n# Base64 encode the binary description file transform.description and write it to the file transform.base64, which is the parameter protoDescription in the configuration interface\nbase64 transform.description |tr -d '\\n' > transform.base64\n")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Example of transform.proto")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-ProtoBuf"},'syntax = "proto3";\npackage test;\nmessage SdkMessage {\n  bytes msg = 1;\n  int64 msgTime = 2;\n  map<string, string> extinfo = 3;\n}\nmessage SdkDataRequest {\n  string sid = 1;\n  repeated SdkMessage msgs = 2;\n  uint64 packageID = 3;\n}\n')),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Example of transform.base64")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-text"},"CrcCCg90cmFuc2Zvcm0ucHJvdG8SBHRlc3QirQEKClNka01lc3NhZ2USEAoDbXNnGAEgASgMUgNtc2cSGAoHbXNnVGltZRgCIAEoA1IHbXNnVGltZRI3CgdleHRpbmZvGAMgAygLMh0udGVzdC5TZGtNZXNzYWdlLkV4dGluZm9FbnRyeVIHZXh0aW5mbxo6CgxFeHRpbmZvRW50cnkSEAoDa2V5GAEgASgJUgNrZXkSFAoFdmFsdWUYAiABKAlSBXZhbHVlOgI4ASJmCg5TZGtEYXRhUmVxdWVzdBIQCgNzaWQYASABKAlSA3NpZBIkCgRtc2dzGAIgAygLMhAudGVzdC5TZGtNZXNzYWdlUgRtc2dzEhwKCXBhY2thZ2VJRBgDIAEoBFIJcGFja2FnZUlEYgZwcm90bzM=\n")),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Example of transform.description\n",(0,n.yg)("img",{src:o(69246).A,width:"1500",height:"1062"}))),(0,n.yg)("h3",{id:"json"},"Json"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'    public JsonSourceInfo(\n            @JsonProperty("charset") String charset,            // Character set\n            @JsonProperty("rowsNodePath") String rowsNodePath)  // Array node path of the Json protocol containing multiple data to be converted\n      );\n')),(0,n.yg)("h2",{id:"sinkinfo-configuration-description"},"SinkInfo Configuration Description"),(0,n.yg)("h3",{id:"csv-1"},"CSV"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'    public CsvSinkInfo(\n            @JsonProperty("charset") String charset,        // Character set\n            @JsonProperty("delimiter") String delimiter,    // Delimiter\n            @JsonProperty("escapeChar") String escapeChar,  // Escape character, if empty, no escaping operation is performed during encoding\n            @JsonProperty("fields") List<FieldInfo> fields) // Field list, if empty, encode by default according to the Select field order of TransformSQL\n      );\n')),(0,n.yg)("h3",{id:"kv-1"},"KV"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-java"},'    public KvSinkInfo(\n            @JsonProperty("charset") String charset,        // Character set\n            @JsonProperty("fields") List<FieldInfo> fields) // Field list, if empty, encode by default using the Alias of Select fields in TransformSQL as the Key\n      );\n')),(0,n.yg)("h1",{id:"transformsql-configuration-description"},"TransformSQL Configuration Description"),(0,n.yg)("h2",{id:"csv--kv-field-reference"},"CSV / KV Field Reference"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"SourceInfo does not have a configured field list.",(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},"For CSV format, field names are referenced using 2, $3..."),(0,n.yg)("li",{parentName:"ul"},"For KV format, field names directly reference the Key in the source data."))),(0,n.yg)("li",{parentName:"ul"},"If the field names in SourceInfo and SinkInfo are inconsistent, you can use the Alias of Select fields to map the conversion.")),(0,n.yg)("h2",{id:"protobuf--json-tree-structure-field-reference"},"ProtoBuf / Json Tree Structure Field Reference"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},'All fields can only be prefixed with "$root.", "$child".',(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},'"$root" means the root node.'),(0,n.yg)("li",{parentName:"ul"},'"$child" means the array node of multiple rows.'))),(0,n.yg)("li",{parentName:"ul"},"For multi-level nodes, use a decimal point to separate, such as $root.extParams.name."),(0,n.yg)("li",{parentName:"ul"},"For array nodes, use parentheses to identify the array index, such as $root.msgs(1).msgTime.")),(0,n.yg)("h2",{id:"operator-support"},"Operator Support"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Currently supported operators",(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},"Arithmetic operators: +, -, *, /, (, )"),(0,n.yg)("li",{parentName:"ul"},"Comparison operators: =, !=, >, >=, <, <="),(0,n.yg)("li",{parentName:"ul"},"Logical operators: and, or, !, not, (, )")))),(0,n.yg)("h2",{id:"function-description"},"Function Description"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"CONCAT(string1, string2, ...), returns a concatenated string of string1, string2, ... If any parameter is NULL, it returns NULL. For example, CONCAT('AA', 'BB', 'CC') returns \"AABBCC\"."),(0,n.yg)("li",{parentName:"ul"},"NOW(), returns the current SQL timestamp in the local timezone."),(0,n.yg)("li",{parentName:"ul"},"See the function description section for details.")),(0,n.yg)("h2",{id:"sql-example"},"SQL Example"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-sql"},"select ftime,extinfo from source where extinfo='ok'\n\nselect $1 ftime,$2 extinfo from source where $2!='ok'\n\nselect $root.sid,$root.packageID,$child.msgTime,$child.msg from source\n\nselect $root.sid,$root.packageID,$root.msgs(1).msgTime,$root.msgs(0).msg from source\n\nselect $root.sid,\n  ($root.msgs(1).msgTime-$root.msgs(0).msgTime)/$root.packageID field2,\n  $root.packageID*($root.msgs(0).msgTime*$root.packageID+$root.msgs(1).msgTime/$root.packageID)*$root.packageID field3,\n  $root.msgs(0).msg field4\nfrom source \nwhere $root.packageID<($root.msgs(0).msgTime+$root.msgs(1).msgTime+$root.msgs(0).msgTime+$root.msgs(1).msgTime)\n\nselect $root.sid,\n  $root.packageID,\n  $child.msgTime,\n  concat($root.sid,$root.packageID,$child.msgTime,$child.msg) msg,$root.msgs.msgTime.msg\nfrom source\n\nselect now() from source\n")),(0,n.yg)("h1",{id:"common-issues"},"Common Issues"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"SDK calls are thread-safe."),(0,n.yg)("li",{parentName:"ul"},"Configuration changes, directly modifying the parameters of the configuration object will not take effect, you need to rebuild the SDK object."),(0,n.yg)("li",{parentName:"ul"},"If the CSV, KV format conversion source data contains line breaks, delimiters (vertical bars, commas, etc.), backslashes (escape characters), you need to configure the correct escape character and line separator.",(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},"If not configured, the field order of the converted data will be disordered, line breaks will cause one piece of data to become two, and vertical bar delimiters will cause field misalignment."))),(0,n.yg)("li",{parentName:"ul"},"Avoid creating an SDK object for each piece of data processed, SDK object initialization requires compiling the conversion SQL and establishing an AST semantic parsing tree, frequent calls will cause performance problems, the recommended usage is to reuse an initialized SDK object to process data in the program.")))}u.isMDXComponent=!0},69246:(e,r,o)=>{o.d(r,{A:()=>t});const t=o.p+"assets/images/transform_description-8efbbfca61b3ffa623d6d5686de7f316.png"}}]);