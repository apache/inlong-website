"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[24675],{15680:(e,n,t)=>{t.d(n,{xA:()=>u,yg:()=>g});var r=t(96540);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(t),m=o,g=p["".concat(l,".").concat(m)]||p[m]||d[m]||a;return t?r.createElement(g,s(s({ref:n},u),{},{components:t})):r.createElement(g,s({ref:n},u))}));function g(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,s=new Array(a);s[0]=m;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[p]="string"==typeof e?e:o,s[1]=i;for(var c=2;c<a;c++)s[c]=t[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},83762:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var r=t(58168),o=(t(96540),t(15680));const a={title:"C++ SDK",sidebar_position:1},s=void 0,i={unversionedId:"sdk/tubemq-sdk/cpp",id:"sdk/tubemq-sdk/cpp",title:"C++ SDK",description:"Build TubeMQ C++ SDK",source:"@site/docs/sdk/tubemq-sdk/cpp.md",sourceDirName:"sdk/tubemq-sdk",slug:"/sdk/tubemq-sdk/cpp",permalink:"/docs/next/sdk/tubemq-sdk/cpp",draft:!1,editUrl:"https://github.com/apache/inlong-website/edit/master/docs/sdk/tubemq-sdk/cpp.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"C++ SDK",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Example",permalink:"/docs/next/sdk/manager-sdk/example"},next:{title:"Python SDK",permalink:"/docs/next/sdk/tubemq-sdk/python"}},l={},c=[{value:"Build TubeMQ C++ SDK",id:"build-tubemq-c-sdk",level:2},{value:"C++ SDK API",id:"c-sdk-api",level:2},{value:"Producer",id:"producer",level:3},{value:"Consumer",id:"consumer",level:3},{value:"Example",id:"example",level:3}],u={toc:c},p="wrapper";function d(e){let{components:n,...t}=e;return(0,o.yg)(p,(0,r.A)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h2",{id:"build-tubemq-c-sdk"},"Build TubeMQ C++ SDK"),(0,o.yg)("p",null,"C++ SDK is based on the non-boost asio, and the CMake is used for building, the commands are\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"# enter the root directory of c++ sdk source\ngit clone https://github.com/apache/inlong.git\ncd inlong/inlong-tubemq/tubemq-client-twins/tubemq-client-cpp\n\nmkdir build && cd build\n\ncmake .. \n\nmake -j8 # the thread num is based on the cpu cores\n\n")),(0,o.yg)("p",null,"The building can also be completed in ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/apache/inlong/tree/master/inlong-tubemq/tubemq-docker/tubemq-cpp"},"docker")," environment provided by InLong."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"# pull image\ndocker pull inlong/tubemq-cpp\n\n# start container and mount the source code\ndocker run -it --net=host -v ${REPLACE_BY_CPP_SOURCE_DIR_PATH}:/tubemq-cpp/  inlong/tubemq-cpp /bin/bash\n\n# same as the build process in physical machines\nmkdir build && cd build\ncmake .. \nmake -j8 \n")),(0,o.yg)("h2",{id:"c-sdk-api"},"C++ SDK API"),(0,o.yg)("p",null,"Similar with other MQ systems\uff0cC++ SDK is diveded into ",(0,o.yg)("strong",{parentName:"p"},"Producer")," and ",(0,o.yg)("strong",{parentName:"p"},"Consumer"),". The API of Producer and Consumer are introduced respectively below."),(0,o.yg)("p",null,"First of all, regardless of role, start the background global TubeMQ SDK service (support the default C++ ",(0,o.yg)("inlineCode",{parentName:"p"},"namespace")," is ",(0,o.yg)("inlineCode",{parentName:"p"},"tubemq"),")\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},"bool StartTubeMQService(string& err_info, const TubeMQServiceConfig& serviceConfig);\n")),(0,o.yg)("p",null,"Look up the return boolean value and the ",(0,o.yg)("inlineCode",{parentName:"p"},"err_info")," to check the start process is successful\u3002"),(0,o.yg)("h3",{id:"producer"},"Producer"),(0,o.yg)("p",null,"The user-level api class is ",(0,o.yg)("inlineCode",{parentName:"p"},"TubeMQProducer"),"\uff0cthe first thing is initializing the class."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},'#include "tubemq/tubemq_client.h" // header file of TubeMQProducer\n\nTubeMQProducer producer;\n')),(0,o.yg)("p",null,"Set the config of producer, then start the producer"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},"ProducerConfig producer_config;\nproducer_config.SetRpcReadTimeoutMs(20000);\nproducer_config.SetMasterAddrInfo(err_info, master_addr);\nbool result = producer.start(); // start producer\n")),(0,o.yg)("p",null,"When ",(0,o.yg)("inlineCode",{parentName:"p"},"register2Master")," is successed\uff0cproducer will send heartbeat request to master periodically to update the meta info of topics. Then users can publish topics, multiple topics can be published at once,  and the param type is ",(0,o.yg)("inlineCode",{parentName:"p"},"std::set"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},'std::set topics{"topic_0", "topic_1"};\nbool result = producer.Publish(err_info, topics);\n')),(0,o.yg)("p",null,"After publishing, construct the message"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},'#include "tubemq/tubemq_message.h" // header file of tubemq::Message\n\nstd::string topic_name = "demo";\nstd::string send_data = "hello_world";\nMessage message(topic_name, send_data.c_str(), send_data.size()); // type is const char*\n')),(0,o.yg)("p",null,"There are two ",(0,o.yg)("inlineCode",{parentName:"p"},"SendMessage")," API: synchronous sending and asynchronous sending."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},"// sync send\nbool TubeMQProducer::SendMessage(string& err_info, const Message& message);\n// async send\nvoid TubeMQProducer::SendMessage(const Message& message, const std::function<void(const ErrorCode&)>& callback);\n")),(0,o.yg)("p",null,"How to use these two ",(0,o.yg)("inlineCode",{parentName:"p"},"SendMessage")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},"bool result = producer.SendMessage(err_info, message);\n\nvoid callback(const ErrorCode&); \nproducer.SendMessage(message, callback); // callback can be other invoked objects\n")),(0,o.yg)("p",null,"Synchronous sending will block until the result is returned, asynchronous sending will not, and the returnted result is received through the user-defined callback function."),(0,o.yg)("p",null,"Finally, close the producer."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},"producer.ShutDown();\n")),(0,o.yg)("h3",{id:"consumer"},"Consumer"),(0,o.yg)("p",null,"Similar with producer\uff0cinitialize the consumer object and set the config."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},'#include "tubemq/tubemq_client.h" // header file of TubeMQConsumer\n\nTubeMQConsumer consumer;\n\n// config of consumption\nConsumerConfig consumer_config;\nconsumer_config.SetRpcReadTimeoutMs(20000);\nconsumer_config.SetMasterAddrInfo(err_info, master_addr);\n// set the consume group and the topic \nconsumer_config.SetGroupConsumeTarget(err_info, group_name, topic_list);\n\n// start the consumer\nconsumer.start();\n')),(0,o.yg)("p",null,"After starting the consumer, invoke the ",(0,o.yg)("inlineCode",{parentName:"p"},"GetMessage")," to get messages."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},"ConsumerResult get_result;\nConsumerResult confirm_result;\n\nbool result = consumer.GetMessage(get_result);\nif (result) {\n    list<Message> messages = get_result.GetMessageList();\n    consumer.Confirm(get_result.GetConfirmContext(), true, confirm_result);\n}\n\n// stop the consumer \nconsumer.ShutDown();\n")),(0,o.yg)("h3",{id:"example"},"Example"),(0,o.yg)("p",null,"There are more detailed examples about C++ SDK in  ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/apache/inlong/tree/master/inlong-tubemq/tubemq-client-twins/tubemq-client-cpp/example"},"C++ SDK Example"),"\uff0cthe compiled executable is located in ",(0,o.yg)("inlineCode",{parentName:"p"},"build/example/producer")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"build/example/consumer")))}d.isMDXComponent=!0}}]);